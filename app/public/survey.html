<!DOCTYPE html>
<html lang="en-us">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

        <title>Friend Finder Survey</title>

        <!-- Compiled and minified CSS - Bootstrap -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    </head>
    <body>

        <div class="container">

            <h1>Survey Questions</h1>

            <hr>

            <form>
                <!-- Input fields for user to provide name and picture -->
                <h2>About You</h2>
                <div class="form-group">
                  <label for="name" class="h5">Name (Required)</label>
                  <input type="text" class="form-control" id="name" placeholder="John Doe" required>
                </div>
                <div class="form-group">
                    <label for="photo" class="h5">Link to Photo Image (Required)</label>
                    <input type="url" class="form-control" id="photo" placeholder="https://mypicture.com" required>
                </div>
                
                <hr>

                <!-- Questions -->
                <div class="form-group">
                    <h3>Question 1</h3>
                    <label for="question1" class="h5">You're outgoing and make friends easily everywhere you go.</label>
                    <select class="form-control" id="question1">
                        <option disabled selected value="">Select an option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="form-group">
                    <h3>Question 2</h3>
                    <label for="question2" class="h5">You're creative and like to explore new ideas.</label>
                    <select class="form-control" id="question2">
                        <option disabled selected value="">Select an option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="form-group">
                    <h3>Question 3</h3>
                    <label for="question3" class="h5">When you go out, you prefer places where you can sit down and talk instead of loud and crowded places.</label>
                    <select class="form-control" id="question3">
                        <option disabled selected value="">Select an option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="form-group">
                    <h3>Question 4</h3>
                    <label for="question4" class="h5">You like to explore the outdoors and going out for a hike is among your favorite things to do.</label>
                    <select class="form-control" id="question4">
                        <option disabled selected value="">Select an option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="form-group">
                    <h3>Question 5</h3>
                    <label for="question5" class="h5">Your favorite activities include quiet time and concentration, such as reading or painting, for example.</label>
                    <select class="form-control" id="question5">
                        <option disabled selected value="">Select an option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="form-group">
                    <h3>Question 6</h3>
                    <label for="question6" class="h5">You'd say that you're more of a "listener" than a "talker" when you're with your friends.</label>
                    <select class="form-control" id="question6">
                        <option disabled selected value="">Select an option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="form-group">
                    <h3>Question 7</h3>
                    <label for="question7" class="h5">You're much more rational than emotional.</label>
                    <select class="form-control" id="question7">
                        <option disabled selected value="">Select an option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="form-group">
                    <h3>Question 8</h3>
                    <label for="question8" class="h5">You can get upset easily.</label>
                    <select class="form-control" id="question8">
                        <option disabled selected value="">Select an option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="form-group">
                    <h3>Question 9</h3>
                    <label for="question9" class="h5">You consider yourself an empathetic person.</label>
                    <select class="form-control" id="question9">
                        <option disabled selected value="">Select an option</option>
                        <option value="1">1 (Strongly Disagree)</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>

                <div class="form-group">
                    <h3>Question 10</h3>
                    <label for="question10" class="h5">You respect others' opinions, even when you don't agree with them.</label>
                    <select class="form-control" id="question10">
                        <option disabled selected value="">Select an option</option>
                        <option value="1">1 (Strongly Disagree)</option>                              
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5 (Strongly Agree)</option>
                    </select>
                </div>
                
                <!-- Submit button -->
                <button type="submit" class="btn btn-primary" id="submit">Submit</button>
            </form>

            <!-- Links to API list an GitHub Repo -->
            <a href="/api/friends">API Friends List</a>
            <a href="https://github.com/amandalragone/FriendFinder">GitHub Repo</a>

            <!-- Modal -->
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="friendMatch" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">

                        <div class="modal-header">
                            <h5 class="modal-title" id="friendMatch">Your best match</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
      
                        <div class="modal-body"></div>
      
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
      
                    </div>
                </div>
            </div>

        </div>
        
        <!-- Compiled and minified JavaScript - Bootstrap -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    
        <!-- Javascript code -->
        <script type="text/javascript">

            //Creating contructor that will build the Friend object.
            function Friend(name, photo, scores) {
                this.name = name;
                this.photo = photo;
                this.scores = scores;
            };
            
            //On click function that tells us what happens after the user presses Submit.
            $("#submit").on("click", function(event){
                
                event.preventDefault(event);
                
                //Defining what are the vars that will be taken from the form.
                var name = $("#name").val().trim();
                var photo = $("#photo").val().trim();
                
                var scores = [];
                var scoreQ1 = $("#question1").val();
                var scoreQ2 = $("#question2").val();
                var scoreQ3 = $("#question3").val();
                var scoreQ4 = $("#question4").val();
                var scoreQ5 = $("#question5").val();
                var scoreQ6 = $("#question6").val();
                var scoreQ7 = $("#question7").val();
                var scoreQ8 = $("#question8").val();
                var scoreQ9 = $("#question9").val();
                var scoreQ10 = $("#question10").val();
                
                scores.push(scoreQ1);
                scores.push(scoreQ2);
                scores.push(scoreQ3);
                scores.push(scoreQ4);
                scores.push(scoreQ5);
                scores.push(scoreQ6);
                scores.push(scoreQ7);
                scores.push(scoreQ8);
                scores.push(scoreQ9);
                scores.push(scoreQ10);
                
                //Using the vars assigned above to build a newFriend.
                var newFriend = new Friend(name, photo, scores);

                //Deleting values from the page.
                $("#name").val("");
                $("#photo").val("");
                
                $("#question1").val("");
                $("#question2").val("");
                $("#question3").val("");
                $("#question4").val("");
                $("#question5").val("");
                $("#question6").val("");
                $("#question7").val("");
                $("#question8").val("");
                $("#question9").val("");
                $("#question10").val(""); 
                
                //Reading what's already written inside the friends API.
                $.get("/api/friends", newFriend).then(function(data) {
                    
                    //Storing the new person's scores.
                    var newFriendScore = newFriend.scores;

                    //Creating a var to store the comparison value. It should always start as undefined.
                    var comparison = undefined;
                    
                    //Mapping the API to get scores of all users.
                    data.map(function(element) {

                        //Total difference will start as 0.
                        var total = 0;

                        //The scores array from the user who's being analyzed will be stored in a var.
                        var userScore = element.scores;

                        //Now, we'll loop through the scores array from the user who's being analyzed.
                        for (var i = 0; i<userScore.length; i++) {

                            //If the current value is different from the user who was just created, the app will calculate the difference.
                            if (userScore[i] !== newFriendScore[i]) {

                                difference = parseInt(userScore[i]) - parseInt(newFriendScore[i]);

                                if (difference < 0) {

                                    difference = difference * (-1);
                                    
                                };

                                //Then, it will add the difference to the total, until it has gotten all the different values.
                                total = total + difference;

                            };

                        };

                        //After coming up with the total, it will check what's the value stored in the comparison var. If it's undefined or more than the total, then it will become the total gotten for that user and that user will be the new match.
                        if ((comparison === undefined) || (comparison > total)) {

                            comparison = total;
                            userMatchName = element.name;
                            userMatchPicture = element.photo;

                            displayMatch(userMatchName, userMatchPicture);

                        };

                    });

                    //After doing all the comparisons, the new friend will be posted into the API.
                    postNewUser(newFriend);

                });

                function displayMatch(name, picture) {

                    var userMatchAlert = `   
                    <h6>${userMatchName}</h6>
                    <img src="${userMatchPicture}" width='300px' height='300px'>
                    `
                    
                    $(".modal-body").html(userMatchAlert);
                    
                };
                

                function postNewUser(newFriend) {

                    //Posting the newFriend var into the API.
                    $.post("/api/friends", newFriend).then(function(data) {

                            $.get("/api/friends", newFriend).then(function(data) {
                                if (data.length > 1) {
                                    $("#myModal").modal("show");
                                } else {
                                    alert("Oh oh, it looks like you're our first friend!");
                                }
                            });
                            
                    });

                };
                    
            });

            


        </script>
    </body>
    
</html>